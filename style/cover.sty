\NeedsTeXFormat{LaTeX2e}

% LaTeX3
\RequirePackage{expl3}
\ProvidesExplPackage{cover}{2016/3/29}{0.0.1}{YaBAskY::Utility::Cover}

% 全局结构
\seq_new:c  { g_seq_cover_items }
\prop_new:c { g_prop_cover_item_value }
\prop_new:c { g_prop_cover_item_name  }

% 定义条目名称
\seq_put_right:cn { g_seq_cover_items } { college }
\seq_put_right:cn { g_seq_cover_items } { title   }
\seq_put_right:cn { g_seq_cover_items } { advisor }
\seq_put_right:cn { g_seq_cover_items } { author  }
\seq_put_right:cn { g_seq_cover_items } { major   }
\seq_put_right:cn { g_seq_cover_items } { class   }
\seq_put_right:cn { g_seq_cover_items } { id      }

% 配置接口
\cs_new:Npn \cover_item_set_name:nn #1#2
  {
    \prop_put:cnn { g_prop_cover_item_name } { #1 } { #2 }
  }

% 用户接口
\cs_new:Npn \cover_set:n #1
  {
    \keys_set:nn { cover } { #1 }
  }

\cs_new:Npn \cover_item_new:n #1
  {
    \keys_define:nn { cover }
      {
        #1 .value_required:n = true,
        #1 .code:n =
          {
            \prop_put:cnn { g_prop_cover_item_value } { #1 } { ##1 }
          }
       }
  }

\seq_map_function:cN { g_seq_cover_items } { \cover_item_new:n }

% 调试接口
\cs_new:Nn \cover_debuginfo:
  {
    \group_begin:
    \section { 封面信息 }
    \begin { itemize }
    \prop_map_inline:cn { g_prop_cover_item_name }
      {
        \prop_get:cnN { g_prop_cover_item_value } { ##1 } { \lv }
        \item { ##2 {\quad} - {\quad} {\lv} }
      }
    \end{ itemize }
    \group_end:
  }